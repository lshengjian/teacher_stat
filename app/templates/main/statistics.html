{% extends 'base.html' %}

{% block title %}数据统计{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>数据统计分析</h2>
    
    <!-- 教师职称统计 -->
    <div class="card mt-4">
        <div class="card-header">
            <h3>教师职称分布</h3>
        </div>
        <div class="card-body">
            {% if position_stats %}
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>职称</th>
                            <th>人数</th>
                            <th>占比</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set total_teachers = position_stats.values()|sum %}
                        {% for position, count in position_stats.items() %}
                        <tr>
                            <td>{{ position }}</td>
                            <td>{{ count }}</td>
                            <td>{{ "%.1f"|format((count/total_teachers*100)) }}%</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p>暂无教师数据</p>
            {% endif %}
        </div>
    </div>
    
    <!-- 项目级别统计 -->
    <div class="card mt-4">
        <div class="card-header">
            <h3>项目级别分布</h3>
        </div>
        <div class="card-body">
            {% if projects_by_level %}
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>项目级别</th>
                            <th>数量</th>
                            <th>占比</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set total_projects = projects_by_level.values()|sum %}
                        {% for level, count in projects_by_level.items() %}
                        <tr>
                            <td>{{ level }}</td>
                            <td>{{ count }}</td>
                            <td>{{ "%.1f"|format((count/total_projects*100)) }}%</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p>暂无项目数据</p>
            {% endif %}
        </div>
    </div>
    
    <!-- 论文级别统计 -->
    <div class="card mt-4">
        <div class="card-header">
            <h3>论文级别分布</h3>
        </div>
        <div class="card-body">
            {% if papers_by_level %}
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>论文级别</th>
                            <th>数量</th>
                            <th>占比</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set total_papers = papers_by_level.values()|sum %}
                        {% for level, count in papers_by_level.items() %}
                        <tr>
                            <td>{{ level }}</td>
                            <td>{{ count }}</td>
                            <td>{{ "%.1f"|format((count/total_papers*100)) }}%</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p>暂无论文数据</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}